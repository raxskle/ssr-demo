# SSR 项目 demo

基于 Node, koa 部署一个处理 CGI 和 SSR 的服务

纯浏览器渲染存在的问题：

1. 浏览器承担执行 JS，渲染页面，请求数据等一系列工作， 会占用浏览器更多的运行内存，导致浏览器变卡。
2. 服务端返回的是空的 HTML，不利于 SEO
3. 浏览器拿到 html 后才请求下载 JS, CSS, IMG 等资源，然后在执行脚本生成页面，造成了一定的白屏时间，降低用户体验。
   服务端渲染有更好的 SEO，更快的内容到达时间 (time-to-content)的优点，为解决浏览器渲染提供了一个好的方案。

## 链路

用户请求 ---> 服务器解析路由找到对应的组件 --> 通过 Renderer 渲染成 HTML 字符串并发送给客户端 ---> 客户端解析 HTML 并加载必要的 JS 文件 ---> 执行 Js 对页面进行激活(Hydrate)。

## 搭建过程

1. 使用 ts-node 和 nodemon 实现 ts 热更新
2. 构建 koa 服务
3. 构建 vue3+vite 的 SSR 服务

## 请求处理

node 端拿到用户请求，根据路径找到对应页面组件，并且根据请求携带数据渲染首屏

## 请求污染

避免状态单例，每个请求都必须是全新的独立的函数调用，在main.ts中createApp需要写成函数

## TODO
- [x] 引入pinia
- [x] 引入vue-router
- [ ] koa处理请求
- [x] 处理打包生产环境
- [ ] 预加载

## 页面路由

由vue-router处理，koa只需要进入页面router。客户端使用WebHistory模式，服务端需要使用MemoryHistory模式，并且手动加入初始路径，确保客户端和用户端解析的路由一致。

## 生产环境构建

